<!DOCTYPE html>
<html>
    <head>
        <title>Calendar Generator</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<style>
			table { 
				width: 750px; 
				border-collapse: collapse; 
				margin:50px auto;
				}

			/* Zebra striping */
			tr:nth-of-type(odd) { 
				background: #eee; 
				}

			th { 
				background: #3498db; 
				color: white; 
				font-weight: bold; 
				}

			td, th { 
				padding: 10px; 
				border: 1px solid #ccc; 
				text-align: left; 
				font-size: 18px;
				}

			/* Spending items styling */
			.spending-item {
				margin: 10px 0;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 5px;
				background: #f9f9f9;
			}

			.spending-item input {
				margin: 5px;
				padding: 5px;
			}

			.item-name {
				width: 200px;
			}

			.item-price {
				width: 100px;
			}

			.remove-item {
				background: #e74c3c;
				color: white;
				border: none;
				padding: 5px 10px;
				border-radius: 3px;
				cursor: pointer;
			}

			.remove-item:hover {
				background: #c0392b;
			}

			#add-item {
				background: #27ae60;
				color: white;
				border: none;
				padding: 8px 15px;
				border-radius: 5px;
				cursor: pointer;
				margin: 10px 0;
			}

			#add-item:hover {
				background: #229954;
			}

			#total-display {
				font-weight: bold;
				font-size: 18px;
				color: #2c3e50;
			}
		</style>
    </head>
    <body>
        <h1>Calendar Generator</h1>
        <form method="get" action="#" id="calendar-form">
            <label for="start-date">Start Date:</label>
            <input type="date" id="start-date" name="start-date"><br>
            <label for="num-days">Number of Days:</label>
            <input type="number" id="num-days" name="num-days"><br>
			<label for="names">Names (separated by comma):</label>
			<input type="text" id="names" name="names"><br>
			
			<label>Spending Items:</label>
			<div id="spending-items">
				<div class="spending-item">
					<input type="text" class="item-name" placeholder="Item name" required>
					<input type="number" class="item-price" placeholder="Price" step="0.01" required>
					<button type="button" class="remove-item" onclick="removeSpendingItem(this)">Remove</button>
				</div>
			</div>
			<button type="button" id="add-item" onclick="addSpendingItem()">Add Item</button><br><br>
			
			<div id="total-display">Total Cost: $0.00</div><br>
            <input type="submit" value="Generate Calendar">
        </form>
		<div id="summary"></div>
        <div id="calendar"></div>
        <script>
			// Get form and calendar elements
			const form = document.getElementById('calendar-form');
			const calendar = document.getElementById('calendar');
			const summary = document.getElementById('summary');

			// Function to add new spending item
			function addSpendingItem() {
				const spendingItems = document.getElementById('spending-items');
				const newItem = document.createElement('div');
				newItem.className = 'spending-item';
				newItem.innerHTML = `
					<input type="text" class="item-name" placeholder="Item name" required>
					<input type="number" class="item-price" placeholder="Price" step="0.01" required>
					<button type="button" class="remove-item" onclick="removeSpendingItem(this)">Remove</button>
				`;
				spendingItems.appendChild(newItem);
				
				// Add event listener to new price input
				const priceInput = newItem.querySelector('.item-price');
				priceInput.addEventListener('input', updateTotal);
			}

			// Function to remove spending item
			function removeSpendingItem(button) {
				const spendingItems = document.getElementById('spending-items');
				const items = spendingItems.querySelectorAll('.spending-item');
				
				// Only allow removal if more than one item exists
				if (items.length > 1) {
					button.parentElement.remove();
					updateTotal();
				} else {
					alert('At least one item is required.');
				}
			}

			// Function to calculate and update total cost
			function updateTotal() {
				const priceInputs = document.querySelectorAll('.item-price');
				let total = 0;
				
				priceInputs.forEach(input => {
					const value = parseFloat(input.value) || 0;
					total += value;
				});
				
				document.getElementById('total-display').textContent = `Total Cost: $${total.toFixed(2)}`;
				return total;
			}

			// Add event listeners to existing price inputs on page load
			document.addEventListener('DOMContentLoaded', function() {
				const priceInputs = document.querySelectorAll('.item-price');
				priceInputs.forEach(input => {
					input.addEventListener('input', updateTotal);
				});
			});

			// Add submit event listener to form
			form.addEventListener('submit', function(e) {
			    e.preventDefault(); // prevent form from submitting

			    // Get start date and number of days inputs
			    const startDateInput = document.getElementById('start-date');
			    const numDaysInput = document.getElementById('num-days');
				const names = document.getElementById('names').value.split(",");
				const totalCost = updateTotal(); // Get total from spending items
				let nameDict = {}
				for (const name of names) {
					nameDict[name] = 0;
				}

			    // Parse input values
			    const startDate = new Date(startDateInput.value);
			    const numDays = parseInt(numDaysInput.value);

			    // Calculate end date
			    const endDate = new Date(startDate.getTime() + (numDays) * 24 * 60 * 60 * 1000);

			    // Generate calendar
			    const calendarHtml = generateCalendarHtml(startDate, endDate, names, nameDict);
			    calendar.innerHTML = calendarHtml;
				
				// Generate summary
				const summaryHtml = generateSummary(nameDict, totalCost);
				summary.innerHTML = summaryHtml;
				
				console.log(nameDict);
			});
			
			// Function to generate summary
			function generateSummary(nameDict, totalCost) {
				let sum = 0;
				
				for (const key in nameDict) {
					if (nameDict.hasOwnProperty(key)) {
						sum += nameDict[key];
					}
				}
				
				// Generate spending items breakdown
				let summaryHtml = '<h2>Spending Items</h2><table><thead><tr><th>Item</th><th>Price</th></tr></thead><tbody>';
				const spendingItems = document.querySelectorAll('.spending-item');
				spendingItems.forEach(item => {
					const itemName = item.querySelector('.item-name').value || 'Unnamed Item';
					const itemPrice = parseFloat(item.querySelector('.item-price').value) || 0;
					summaryHtml += `<tr><td>${itemName}</td><td>$${itemPrice.toFixed(2)}</td></tr>`;
				});
				summaryHtml += `<tr style="font-weight: bold; background: #3498db; color: white;"><td>Total</td><td>$${totalCost.toFixed(2)}</td></tr>`;
				summaryHtml += '</tbody></table><br>';
				
				// Generate cost breakdown by person
				summaryHtml += '<h2>Cost Breakdown by Person</h2><table><thead><tr><th>Name</th><th>Days</th><th>Cost</th></tr></thead><tbody>'
				for (const name in nameDict) {
					if (nameDict.hasOwnProperty(name)) {
						let cost = (nameDict[name] / sum) * totalCost;
						cost = (Math.round(cost * 100) / 100).toFixed(2);
						summaryHtml += `<tr><td>${name}</td><td>${nameDict[name]}</td><td>$${cost}</td></tr>`;
					}
				}
				
				summaryHtml += '</tbody></table>';
				return summaryHtml;
			}

			// Function to generate calendar HTML
			function generateCalendarHtml(startDate, endDate, names, nameDict) {
				console.log("startDate:" + startDate);
				console.log("endDate:" + endDate);
			    let calendarHtml = '';
				let isFirstMonth = true;
				let isLastMonth = false;
				let nameIdx = 0;
				
			    // Loop through each month
			    for (let date = new Date(startDate.getFullYear(), startDate.getMonth(), 1); date <= endDate; date.setMonth(date.getMonth() + 1)) {
					console.log("processing Month:" + date);
					console.log("is date <= endDate?" + date <= endDate);
					if(new Date(date.getFullYear(), date.getMonth() + 1, 1) > endDate) {
						isLastMonth = true;
					}
				
			        // Get month and year
			        const month = date.toLocaleString('default', {
			            month: 'long'
			        });
			        const year = date.getFullYear();

			        // Generate month header
			        calendarHtml += `<h2>${month} ${year}</h2>`;

			        // Generate table header
			        calendarHtml += '<table><thead><tr>';
			        calendarHtml += '<th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>';
			        calendarHtml += '</tr></thead><tbody>';

			        // Get first day of the month
			        const firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);

			        // Generate table rows
					let dayOfMonth = startDate.getDate()+1;
					let firstDayOfMonthIndex = (startDate.getDay() + 1) % 7;
					if(!isFirstMonth) {
						dayOfMonth = 1;
						firstDayOfMonthIndex = firstDayOfMonth.getDay();
					}
					let lastDayOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
					if(isLastMonth) {
						lastDayOfMonth = endDate.getDate();
					}
			        while (dayOfMonth <= lastDayOfMonth) {
			            calendarHtml += '<tr>';

			            // Generate cells for each day of the week
			            for (let i = 0; i < 7; i++) {
							// if firstMonth, then need to skip the first few days if the first day is not sunday
							if (isFirstMonth && i < firstDayOfMonthIndex) {
								calendarHtml += '<td></td>';
							} else if ((i >= firstDayOfMonthIndex || dayOfMonth > 1) && dayOfMonth <= lastDayOfMonth) {
								isFirstMonth = false;
								let currentName = names[nameIdx];
								calendarHtml += `<td>${dayOfMonth}<br>${currentName}</td>`;
								dayOfMonth++;
								nameDict[names[nameIdx]] = nameDict[names[nameIdx]] + 1;
								nameIdx = (nameIdx + 1) % (names.length);
			                } else {
			                    calendarHtml += '<td></td>';
			                }
			            }

			            calendarHtml += '</tr>';
			        }

			        calendarHtml += '</tbody></table>';
			    }

			    return calendarHtml;
			}
		</script>
    </body>
</html>